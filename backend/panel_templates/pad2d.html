<!DOCTYPE html>
<html>
<head>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { background: #27272a; overflow: hidden; width: 100%; height: 100vh; display: flex; flex-direction: column; }
  .header { padding: 4px 8px; font: 11px/1 system-ui, sans-serif; color: #a1a1aa; display: flex; justify-content: flex-end; }
  .pad { flex: 1; position: relative; margin: 6px; border-radius: 4px; background: #18181b; border: 1px solid #3f3f46; cursor: crosshair; touch-action: none; }
  .crossH { position: absolute; left: 0; right: 0; height: 1px; background: #52525b; pointer-events: none; }
  .crossV { position: absolute; top: 0; bottom: 0; width: 1px; background: #52525b; pointer-events: none; }
  .dot { position: absolute; width: 10px; height: 10px; border-radius: 50%; background: #6366f1; border: 1.5px solid #fff; pointer-events: none; transform: translate(-50%, -50%); }
</style>
</head>
<body>
<div class="header"><span id="vals">0.00, 0.00</span></div>
<div class="pad" id="pad">
  <div class="crossH" id="ch"></div>
  <div class="crossV" id="cv"></div>
  <div class="dot" id="dot"></div>
</div>
<script>
const CONFIG = {};

var uniform = CONFIG.uniform || "u_pad";
var minX = (CONFIG.min && CONFIG.min[0]) != null ? CONFIG.min[0] : -1;
var minY = (CONFIG.min && CONFIG.min[1]) != null ? CONFIG.min[1] : -1;
var maxX = (CONFIG.max && CONFIG.max[0]) != null ? CONFIG.max[0] : 1;
var maxY = (CONFIG.max && CONFIG.max[1]) != null ? CONFIG.max[1] : 1;
var defX = (CONFIG.default && CONFIG.default[0]) != null ? CONFIG.default[0] : 0;
var defY = (CONFIG.default && CONFIG.default[1]) != null ? CONFIG.default[1] : 0;

var pos = [defX, defY];
var dragging = false;
var pad = document.getElementById("pad");

function updateVisual() {
  var nx = (pos[0] - minX) / (maxX - minX) * 100;
  var ny = (maxY - pos[1]) / (maxY - minY) * 100;
  document.getElementById("ch").style.top = ny + "%";
  document.getElementById("cv").style.left = nx + "%";
  document.getElementById("dot").style.left = nx + "%";
  document.getElementById("dot").style.top = ny + "%";
  document.getElementById("vals").textContent = pos[0].toFixed(2) + ", " + pos[1].toFixed(2);
}

function updateFromPointer(e) {
  var rect = pad.getBoundingClientRect();
  var nx = Math.max(0, Math.min(1, (e.clientX - rect.left) / rect.width));
  var ny = Math.max(0, Math.min(1, (e.clientY - rect.top) / rect.height));
  pos[0] = minX + nx * (maxX - minX);
  pos[1] = maxY - ny * (maxY - minY);
  updateVisual();
  panel.setUniform(uniform, [pos[0], pos[1]]);
}

pad.addEventListener("pointerdown", function(e) {
  dragging = true;
  pad.setPointerCapture(e.pointerId);
  updateFromPointer(e);
});
pad.addEventListener("pointermove", function(e) {
  if (dragging) updateFromPointer(e);
});
pad.addEventListener("pointerup", function() { dragging = false; });
pad.addEventListener("dblclick", function() {
  pos = [defX, defY];
  updateVisual();
  panel.setUniform(uniform, [pos[0], pos[1]]);
});

// Init
updateVisual();
panel.setUniform(uniform, [pos[0], pos[1]]);

// Sync from external changes
panel.onUpdate = function(p) {
  var v = p.uniforms[uniform];
  if (v && Array.isArray(v)) {
    if (Math.abs(v[0] - pos[0]) > 0.001 || Math.abs(v[1] - pos[1]) > 0.001) {
      pos = [v[0], v[1]];
      updateVisual();
    }
  }
};
</script>
</body>
</html>
